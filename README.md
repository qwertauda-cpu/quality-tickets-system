# نظام إدارة التكتات والجودة
## Quality & Tickets Management System

نظام شامل لإدارة التكتات وتقييم الجودة للفرق الفنية في شركة FTTH.

## المميزات

✅ إدخال تكتات يدوي من قبل موظف الجودة  
✅ نظام نقاط أوتوماتيكي شامل  
✅ رفع صور للتكتات  
✅ تقييم جودة الاتصال بالمشترك  
✅ توليد رسائل جاهزة تلقائياً  
✅ تقارير PDF يومية  
✅ عرض النقاط اليومية والشهرية  
✅ صفحات منفصلة لكل فريق  
✅ صفحة شفافية تعرض نقاط الجميع  

## المتطلبات

- Node.js 18.x أو أحدث
- MySQL 5.7 أو أحدث
- npm أو yarn

## التثبيت

### 1. تثبيت Dependencies

```bash
cd api
npm install
```

### 2. إعداد قاعدة البيانات

أنشئ ملف `.env` في مجلد `api/`:

```bash
cp ENV_TEMPLATE.env .env
```

عدّل إعدادات قاعدة البيانات في ملف `.env`:

```
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=quality_tickets_system
PORT=3001
```

### 3. تهيئة قاعدة البيانات

```bash
npm run init-db
```

هذا سيقوم بـ:
- إنشاء قاعدة البيانات
- إنشاء جميع الجداول
- إدراج البيانات الأولية (أنواع التكتات، الفرق، قوالب الرسائل)
- إنشاء حساب المدير الافتراضي: `admin / admin123`
- إنشاء حساب موظف الجودة: `quality / quality123`

### 4. تشغيل الخادم

```bash
npm start
```

أو للتطوير:

```bash
npm run dev
```

الخادم سيعمل على: `http://localhost:3001`

## الاستخدام

### تسجيل الدخول

افتح المتصفح واذهب إلى: `http://localhost:3001`

**الحسابات الافتراضية:**
- المدير: `admin / admin123`
- موظف الجودة: `quality / quality123`

### الواجهات

1. **لوحة الإدارة** (`/admin-dashboard.html`)
   - عرض إحصائيات شاملة
   - ترتيب الفرق
   - تقارير يومية/شهرية

2. **واجهة موظف الجودة** (`/quality-staff.html`)
   - إدخال تكتات جديدة
   - رفع صور
   - تقييم الجودة
   - توليد رسائل

3. **واجهة الفرق** (`/team-dashboard.html`)
   - عرض نقاط الفريق
   - عرض نقاط جميع الفرق
   - ترتيب الشهر

## هيكل المشروع

```
quality-tickets-system/
├── api/
│   ├── server.js              # الخادم الرئيسي
│   ├── config.js              # إعدادات
│   ├── db-manager.js           # إدارة قاعدة البيانات
│   ├── scoring-logic.js        # منطق حساب النقاط
│   ├── init-quality-db.js      # تهيئة قاعدة البيانات
│   ├── package.json
│   └── ENV_TEMPLATE.env
├── public/
│   ├── index.html              # صفحة تسجيل الدخول
│   ├── quality-staff.html      # واجهة موظف الجودة
│   ├── admin-dashboard.html    # لوحة الإدارة
│   ├── team-dashboard.html     # واجهة الفرق
│   ├── css/
│   │   └── style.css           # التصميم الرئيسي
│   └── js/
│       ├── auth.js             # المصادقة
│       ├── api.js              # دوال API
│       └── quality-staff.js    # واجهة موظف الجودة
└── uploads/                    # الصور المرفوعة
```

## نظام النقاط

### النقاط الموجبة

- **نوع التكت**: 2-10 نقاط حسب النوع
- **السرعة**: +10 (ممتاز) / +5 (مقبول) / 0 (متأخر)
- **الجودة**: +10 (التكت كامل بالصور)
- **السلوك**: +10 (ممتاز) / +5 (جيد) / 0 (طبيعي)
- **البيع**: +10 لكل منتج (Router, ONU, UPS)
- **البونص اليومي**: +15 (7 ربط) / +15 (15 صيانة) / +30 (الاثنين معاً)
- **البونص الشهري**: +100 (20 يوم عمل)

### النقاط السالبة

- **نقص الصور**: -2 لكل صورة ناقصة
- **إغلاق بدون إكمال**: -15
- **السلوك السلبي**: -10 إلى -20
- **التأجيل**: -5 (يوم واحد) / -10 (أكثر) / -15 (بدون سبب)
- **عدم الرد**: -10 (ما رد) / -5 (رد متأخر)

## أنواع التكتات

1. ربط جديد FTTH (SLA: 45-60 دقيقة)
2. تفعيل بدون سحب كيبل (SLA: 20-30)
3. تبديل راوتر/ONU (SLA: 20-35)
4. قطع فايبر (SLA: 30-45)
5. ضعف إشارة RX (SLA: 25-40)
6. إعداد PPPoE/DHCP (SLA: 15-25)
7. WiFi بدون تمديد (SLA: 15-30)
8. عبث مشترك / كهرباء (SLA: 15-20)
9. صيانة خارجية / فات (SLA: 30-45)
10. فحص فقط (SLA: 10-15)
11. إعادة ربط (SLA: 30-60)
12. زيارة تسويقية (SLA: 10-15)

## Load Factor

- حد الربط: 7 تكتات/يوم لكل فريق
- حد الصيانة: 15 تكت/يوم لكل فريق

إذا تجاوز الفريق الحد:
```
AdjustedTime = ActualTime ÷ LoadFactor
```

## الصور المطلوبة

لكل تكت يجب رفع:
- فات العامود قبل/بعد
- PPPoE
- مكان الأجهزة
- بور المشترك
- وضع DHCP
- سبيد تيست
- بنك جوجل
- رسالة التفعيل
- RX Power

## التطوير

### إضافة نوع تكت جديد

1. أضف السجل في جدول `ticket_types`
2. أو استخدم واجهة الإدارة (قريباً)

### تعديل نظام النقاط

عدّل ملف `api/scoring-logic.js`

## الدعم

للمساعدة أو الإبلاغ عن مشاكل، يرجى فتح issue في المستودع.

## الترخيص

ISC License

