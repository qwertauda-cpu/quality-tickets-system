<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>ูุงุฌูุฉ ููุธู ุงูุฌูุฏุฉ - ูุธุงู ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑ</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">โฐ</button>
    <div class="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>๐ ููุธู ุงูุฌูุฏุฉ</h2>
                <p id="userName"></p>
            </div>
            <ul class="sidebar-menu" id="sidebarMenu"></ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1 id="pageTitle">ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑ</h1>
                <div class="user-info">
                    <span id="currentUser"></span>
                    <a href="#" class="btn-logout" onclick="logout(); return false;">ุชุณุฌูู ุงูุฎุฑูุฌ</a>
                </div>
            </div>

            <!-- Ticket Details Page (for adding photos and quality review) -->
            <div id="ticket-details-page" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>ุชูุงุตูู ุงูุชุฐูุฑุฉ #<span id="detail-ticket-number"></span></h2>
                        <button class="btn btn-secondary" onclick="showPage('new-ticket')">โ ุฑุฌูุน</button>
                    </div>
                    <div class="card-body">
                        <!-- Photos Section -->
                        <div style="margin-bottom: 30px;">
                            <h3>ุฑูุน ุงูุตูุฑ</h3>
                            <div class="form-group">
                                <label>ููุน ุงูุตูุฑุฉ</label>
                                <select id="photo_type">
                                    <option value="pole_before">ูุงุช ุงูุนุงููุฏ ูุจู</option>
                                    <option value="pole_after">ูุงุช ุงูุนุงููุฏ ุจุนุฏ</option>
                                    <option value="pppoe">PPPoE</option>
                                    <option value="equipment_location">ููุงู ุงูุฃุฌูุฒุฉ</option>
                                    <option value="subscriber_power">ุจูุฑ ุงููุดุชุฑู</option>
                                    <option value="dhcp_status">ูุถุน DHCP</option>
                                    <option value="speed_test">ุณุจูุฏ ุชูุณุช</option>
                                    <option value="google_bank">ุจูู ุฌูุฌู</option>
                                    <option value="activation_message">ุฑุณุงูุฉ ุงูุชูุนูู</option>
                                    <option value="rx_power">RX Power</option>
                                </select>
                            </div>
                            <div class="photo-upload-area" id="photoUploadArea">
                                <p>ุงุณุญุจ ุงูุตูุฑ ููุง ุฃู ุงุถุบุท ููุงุฎุชูุงุฑ</p>
                                <input type="file" id="photoInput" multiple accept="image/*" style="display: none;">
                            </div>
                            <div class="photo-grid" id="photoGrid"></div>
                        </div>

                        <!-- Quality Review Section -->
                        <div style="margin-bottom: 30px;">
                            <h3>ุชูููู ุงูุฌูุฏุฉ</h3>
                            <form id="qualityReviewForm">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="contact_status">ุญุงูุฉ ุงูุงุชุตุงู *</label>
                                        <select id="contact_status" required>
                                            <option value="answered">ุชู ุงูุฑุฏ</option>
                                            <option value="no_answer">ูู ูุฑุฏ</option>
                                            <option value="closed">ูุบูู</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="service_status">ุญุงูุฉ ุงูุฎุฏูุฉ *</label>
                                        <select id="service_status" required>
                                            <option value="excellent">ููุชุงุฒ</option>
                                            <option value="good">ุฌูุฏ</option>
                                            <option value="poor">ุฑุฏูุก</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="team_rating">ุชูููู ุฃุฏุงุก ุงููุฑูู (1-5) *</label>
                                        <input type="number" id="team_rating" min="1" max="5" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="behavior_rating">ุชูููู ุงูุณููู *</label>
                                        <select id="behavior_rating" required>
                                            <option value="excellent">ููุชุงุฒ (+10)</option>
                                            <option value="good">ุฌูุฏ (+5)</option>
                                            <option value="normal">ุทุจูุนู (0)</option>
                                            <option value="bad">ุณูุก (-10)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="subscription_amount">ูุจูุบ ุงูุงุดุชุฑุงู</label>
                                        <input type="number" id="subscription_amount" step="0.01">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>ููุงุท ุงูุจูุน (Upsell):</label>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="upsell_router">
                                        <label for="upsell_router">ุจูุน ุฑุงูุชุฑ (+10)</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="upsell_onu">
                                        <label for="upsell_onu">ุจูุน ONU (+10)</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="upsell_ups">
                                        <label for="upsell_ups">ุจูุน UPS (+10)</label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>ุงูุฎุฏูุงุช ุงููุดุฑูุญุฉ ูููุดุชุฑู:</label>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="explained_sinmana">
                                        <label for="explained_sinmana">ุณูููุงูุง</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="explained_platform">
                                        <label for="explained_platform">ููุตุฉ</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="explained_mytv_plus">
                                        <label for="explained_mytv_plus">MyTV+</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="explained_shahid_plus">
                                        <label for="explained_shahid_plus">ุดุงูุฏ ุจูุณ</label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="whatsapp_group_interest">
                                        <label for="whatsapp_group_interest">ูุฑุบุจ ุจุงูุงูุถูุงู ููุฑูุจ ุงููุงุชุณุงุจ</label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="needs_followup">
                                        <label for="needs_followup">ูุญุชุงุฌ ูุชุงุจุนุฉ</label>
                                    </div>
                                </div>
                                
                                <div class="form-group" id="followupReasonGroup" style="display: none;">
                                    <label for="followup_reason">ุณุจุจ ุงููุชุงุจุนุฉ</label>
                                    <select id="followup_reason">
                                        <option value="amount_mismatch">ูุจูุบ ุบูุฑ ูุชุทุงุจู</option>
                                        <option value="technical_issue">ูุดููุฉ ูููุฉ</option>
                                        <option value="violation">ุชุฌุงูุฒ</option>
                                        <option value="complaint">ุดููู</option>
                                        <option value="poor_service">ุฎุฏูุฉ ุฑุฏูุฆุฉ</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="review_notes">ููุงุญุธุงุช ุงูุฌูุฏุฉ</label>
                                    <textarea id="review_notes" rows="3"></textarea>
                                </div>
                                
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">ุญูุธ ุงูุชูููู</button>
                                    <button type="button" class="btn btn-success" onclick="generateMessage()">ุชูููุฏ ุฑุณุงูุฉ</button>
                                </div>
                            </form>
                        </div>

                        <!-- Generated Message -->
                        <div id="messageSection" style="display: none;">
                            <h3>ุงูุฑุณุงูุฉ ุงูุฌุงูุฒุฉ</h3>
                            <div class="message-box">
                                <textarea id="generatedMessage" readonly></textarea>
                                <button class="btn btn-copy" onclick="copyMessage()">ูุณุฎ ุงูุฑุณุงูุฉ</button>
                            </div>
                        </div>

                        <!-- Scores Display -->
                        <div id="scoresSection" style="margin-top: 30px;">
                            <h3>ุงูููุงุท</h3>
                            <div class="score-display" id="scoreDisplay"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickets Management Page -->
            <div id="tickets-management-page" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑ</h2>
                        <button class="btn btn-primary" onclick="openCreateTicketModal()" style="margin-right: 10px;">โ ุฅูุดุงุก ุชุฐูุฑุฉ</button>
                    </div>
                    <div class="card-body">
                        <!-- Tabs/Filters -->
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; flex-wrap: wrap;">
                            <button class="btn btn-tab active" onclick="filterTicketsByStatus('NEW')" data-status="NEW">ุงูุชุฐุงูุฑ ุงููุนููุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatus('COMPLETED')" data-status="COMPLETED">ุงูุชุฐุงูุฑ ุงูููุฌุฒุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatus('FOLLOW_UP')" data-status="FOLLOW_UP">ุงูุชุฐุงูุฑ ุงููุคุฌูุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatus('CLOSED')" data-status="CLOSED">ุงูุชุฐุงูุฑ ุงูููุชููุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatus('all')" data-status="all">ุฌููุน ุงูุชุฐุงูุฑ</button>
                        </div>
                        
                        <div class="table-container">
                            <table id="ticketsManagementTable">
                                <thead>
                                    <tr>
                                        <th>ุฑูู ุงูุชุฐูุฑุฉ</th>
                                        <th>ุงุณู ุงููุดุชุฑู</th>
                                        <th>ุงููุฑูู</th>
                                        <th>ุงูุญุงูุฉ</th>
                                        <th>ุงูููุน</th>
                                        <th>ุงูููุช ุงููุนูู</th>
                                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                    </tr>
                                </thead>
                                <tbody id="ticketsManagementTableBody">
                                    <tr>
                                        <td colspan="7" class="loading">ุฌุงุฑู ุงูุชุญููู...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Tickets Management Page -->
            <div id="tickets-management-new-page" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>ุฅุฏุงุฑุฉ ุชุฐูุฑุฉุงุช</h2>
                        <button class="btn btn-primary" onclick="openCreateTicketModal()" style="margin-right: 10px;">โ ุฅูุดุงุก ุชุฐูุฑุฉ</button>
                    </div>
                    <div class="card-body">
                        <!-- Tabs/Filters -->
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; flex-wrap: wrap;">
                            <button class="btn btn-tab active" onclick="filterTicketsByStatusNew('NEW')" data-status="NEW">ุงูุชุฐุงูุฑ ุงููุนููุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatusNew('COMPLETED')" data-status="COMPLETED">ุงูุชุฐุงูุฑ ุงูููุฌุฒุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatusNew('FOLLOW_UP')" data-status="FOLLOW_UP">ุงูุชุฐุงูุฑ ุงููุคุฌูุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatusNew('CLOSED')" data-status="CLOSED">ุงูุชุฐุงูุฑ ุงูููุชููุฉ</button>
                            <button class="btn btn-tab" onclick="filterTicketsByStatusNew('all')" data-status="all">ุฌููุน ุงูุชุฐุงูุฑ</button>
                        </div>
                        
                        <div class="table-container">
                            <table id="ticketsManagementNewTable">
                                <thead>
                                    <tr>
                                        <th>ุฑูู ุงูุชุฐูุฑุฉ</th>
                                        <th>ุงุณู ุงููุดุชุฑู</th>
                                        <th>ุฑูู ุงููุงุชู</th>
                                        <th>ููุน ุงูุชุฐูุฑุฉ</th>
                                        <th>ุงูููุทูุฉ</th>
                                        <th>ุงูุญุงูุฉ</th>
                                        <th>ุชุงุฑูุฎ ุงูุฅูุดุงุก</th>
                                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                    </tr>
                                </thead>
                                <tbody id="ticketsManagementNewTableBody">
                                    <tr>
                                        <td colspan="8" class="loading">ุฌุงุฑู ุงูุชุญููู...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickets List Page (Quality Management) -->
            <div id="tickets-list-page" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>ุฅุฏุงุฑุฉ ุฌูุฏุฉ</h2>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="ticketsTable">
                                <thead>
                                    <tr>
                                        <th>ุฑูู ุงูุชุฐูุฑุฉ</th>
                                        <th>ุงุณู ุงููุดุชุฑู</th>
                                        <th>ุงููุฑูู</th>
                                        <th>ุงูุญุงูุฉ</th>
                                        <th>ุงูููุน</th>
                                        <th>ุงูููุช ุงููุนูู</th>
                                        <th>ุงูููุงุท</th>
                                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                    </tr>
                                </thead>
                                <tbody id="ticketsTableBody">
                                    <tr>
                                        <td colspan="8" class="loading">ุฌุงุฑู ุงูุชุญููู...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- New Ticket Modal -->
    <div id="new-ticket-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>ุฅุฏุฎุงู ุชุฐูุฑุฉ ุฌุฏูุฏ 
                    <span style="font-size: 0.8em; font-weight: normal; color: var(--text-secondary); margin-right: 15px;">
                        ุงูููุงุท ุงูููุชุณุจุฉ: <span id="headerQualityPoints">0</span> | 
                        ุงูููุงุท ุงููุฎุตููุฉ: <span id="headerPenaltyPoints">0</span> | 
                        ุงูููุงุท ุงููููุฉ: <span id="headerTotalPoints">0</span>
                    </span>
                </h2>
                <button class="modal-close-btn" onclick="closeNewTicketModal()">ร</button>
            </div>
            <div class="modal-body">
                <form id="ticketFormModal">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="ticket_number_modal">ุฑูู ุงูุชุฐูุฑุฉ *</label>
                            <input type="text" id="ticket_number_modal" pattern="[0-9]+" inputmode="numeric" autocomplete="off" required>
                            <small class="form-text" style="color: #666; font-size: 0.85em;">ูุฌุจ ุฃู ูุญุชูู ุนูู ุฃุฑูุงู ุฅูุฌููุฒูุฉ ููุท (0-9)</small>
                            <div id="ticket_number_error_modal" class="error-message" style="display: none; color: #dc3545; font-size: 0.875em; margin-top: 5px; padding: 8px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="subscriber_name_modal">ุงุณู ุงููุดุชุฑู</label>
                            <input type="text" id="subscriber_name_modal">
                        </div>
                        
                        <div class="form-group">
                            <label for="subscriber_phone_modal">ุฑูู ุงููุดุชุฑู</label>
                            <input type="text" id="subscriber_phone_modal" pattern="[0-9]{11}" inputmode="numeric" maxlength="11" autocomplete="off">
                            <small class="form-text" style="color: var(--text-muted); font-size: 0.85em; margin-top: 5px; display: block;">ูุฌุจ ุฃู ูุญุชูู ุนูู 11 ุฑูู ุฅูุฌููุฒู ููุท (0-9)</small>
                            <div id="subscriber_phone_error_modal" class="error-message" style="display: none; color: #dc3545; font-size: 0.875em; margin-top: 5px; padding: 8px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="ticket_type_id_modal">ููุน ุงูุชุฐูุฑุฉ *</label>
                            <select id="ticket_type_id_modal" required>
                                <option value="">ุงุฎุชุฑ ุงูููุน</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="team_id_modal">ุงููุฑูู *</label>
                            <select id="team_id_modal" required>
                                <option value="">ุงุฎุชุฑ ุงููุฑูู</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="assigned_technician_id_modal">ุงูููู ุงููููู</label>
                            <select id="assigned_technician_id_modal">
                                <option value="">ุงุฎุชุฑ ุงูููู (ุงุฎุชูุงุฑู)</option>
                            </select>
                            <small class="form-text" style="color: var(--text-muted); font-size: 0.85em;">ุฅุฐุง ูู ุชุฎุชุฑ ูููุ ุณูุชู ุฅุฑุณุงู ุงูุชุฐูุฑุฉ ูููุฑูู ููุท</small>
                        </div>
                        
                        <!-- ุญููู ุงูุชุงุฑูุฎ - ูุฑุชุจุฉ ุนููุฏูุงู -->
                        <div style="grid-column: 1 / -1; display: flex; flex-direction: column; gap: 20px;">
                            <div class="form-group" style="padding: 18px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color); margin: 0;">
                                <label style="display: block; margin-bottom: 12px; font-weight: 600; font-size: 1.05em; color: var(--text-primary);">ุชุงุฑูุฎ ุงุณุชูุงู ุงูุชุฐูุฑุฉ (T0) *</label>
                                <div id="time_received_container_modal"></div>
                                <div id="time_received_time_container_modal" style="margin-top: 10px;"></div>
                            </div>
                            
                            <div class="form-group" style="padding: 18px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color); margin: 0;">
                                <label style="display: block; margin-bottom: 12px; font-weight: 600; font-size: 1.05em; color: var(--text-primary);">ุชุงุฑูุฎ ุงูู ุฑุฏ (T1)</label>
                                <div id="time_first_contact_container_modal"></div>
                                <div id="time_first_contact_time_container_modal" style="margin-top: 10px;"></div>
                            </div>
                            
                            <div class="form-group" style="padding: 18px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color); margin: 0;">
                                <label style="display: block; margin-bottom: 12px; font-weight: 600; font-size: 1.05em; color: var(--text-primary);">ุชุงุฑูุฎ ุงููุงู ุงูุชุฐูุฑุฉ (T2)</label>
                                <div id="time_completed_container_modal"></div>
                                <div id="time_completed_time_container_modal" style="margin-top: 10px;"></div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <!-- Divider between ticket info and quality sections -->
                <div style="border-top: 2px solid var(--border-color); margin: 30px 0;"></div>
                
                <!-- Title: ุชูููู ุงูุฌูุฏุฉ -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; font-size: 1.3em; color: var(--text-primary);">ุชูููู ุงูุฌูุฏุฉ</h3>
                </div>
                
                <!-- Checklist Container (replaces Photos Section) -->
                <div id="checklistContainerWrapper" style="display: none; margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">ูุงุฆูุฉ ุงููุชุทูุจุงุช (Checklist)</h3>
                    <div id="checklistContainer" class="checklist-vertical-list"></div>
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                        <strong style="font-size: 1.1em;">ููุงุท Checklist: <span id="qualityPoints">0</span></strong>
                    </div>
                </div>
                
                <!-- Photos Section (hidden by default) -->
                <div id="photosSectionModal" style="display: none; margin-top: 30px;">
                    <h3>ุฑูุน ุงูุตูุฑ</h3>
                    <div class="form-group">
                        <label>ููุน ุงูุตูุฑุฉ</label>
                        <select id="photo_type_new_modal">
                            <option value="pole_before">ูุงุช ุงูุนุงููุฏ ูุจู</option>
                            <option value="pole_after">ูุงุช ุงูุนุงููุฏ ุจุนุฏ</option>
                            <option value="pppoe">PPPoE</option>
                            <option value="equipment_location">ููุงู ุงูุฃุฌูุฒุฉ</option>
                            <option value="subscriber_power">ุจูุฑ ุงููุดุชุฑู</option>
                            <option value="dhcp_status">ูุถุน DHCP</option>
                            <option value="speed_test">ุณุจูุฏ ุชูุณุช</option>
                            <option value="google_bank">ุจูู ุฌูุฌู</option>
                            <option value="activation_message">ุฑุณุงูุฉ ุงูุชูุนูู</option>
                            <option value="rx_power">RX Power</option>
                        </select>
                    </div>
                    <div class="photo-upload-area" id="photoUploadAreaNewModal">
                        <p>ุงุณุญุจ ุงูุตูุฑ ููุง ุฃู ุงุถุบุท ููุงุฎุชูุงุฑ</p>
                        <input type="file" id="photoInputNewModal" multiple accept="image/*" style="display: none;">
                    </div>
                    <div class="photo-grid" id="photoGridNewModal"></div>
                </div>

                <!-- Quality Review Section (shown directly) -->
                <div id="qualityReviewSectionModal" style="margin-top: 30px;">
                    <h3>ุงูุงุชุตุงู ุจุงููุดุชุฑู</h3>
                    
                    <!-- ุฑูู ุงููุงุชู -->
                    <div style="margin-bottom: 20px; padding: 15px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                        <label for="phone_number_modal" style="display: block; margin-bottom: 8px; font-weight: 500;">ุฑูู ุงููุงุชู</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="phone_number_modal" readonly style="flex: 1; padding: 10px; border-radius: 8px; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
                            <button type="button" id="copyPhoneNumberBtn" class="btn btn-secondary" style="white-space: nowrap;" onclick="copyPhoneNumber()">ูุณุฎ</button>
                        </div>
                        <small class="form-text" style="color: var(--text-muted); font-size: 0.85em; margin-top: 5px; display: block;">ูุชู ููุคู ุชููุงุฆูุงู ูู ุฑูู ุงููุดุชุฑู ูุน ุฅุถุงูุฉ 5 ูู ุงูุจุฏุงูุฉ</small>
                    </div>
                    
                    <form id="qualityReviewFormNewModal">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="contact_status_new_modal">ุญุงูุฉ ุงูุงุชุตุงู *</label>
                                <select id="contact_status_new_modal" required>
                                    <option value="answered">ุชู ุงูุฑุฏ</option>
                                    <option value="no_answer">ูู ูุฑุฏ</option>
                                    <option value="closed">ูุบูู</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="service_status_new_modal">ุญุงูุฉ ุงูุฎุฏูุฉ *</label>
                                <select id="service_status_new_modal" required>
                                    <option value="excellent">ููุชุงุฒ</option>
                                    <option value="good">ุฌูุฏ</option>
                                    <option value="poor">ุฑุฏูุก</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="team_rating_new_modal" style="display: flex; align-items: center; gap: 8px;">
                                    <span>ุชูููู ุฃุฏุงุก ุงููุฑูู (1-5) *</span>
                                    <span class="tooltip-trigger" style="cursor: help; color: var(--primary-color); font-size: 18px; position: relative;">
                                        ุ
                                        <span class="tooltip-content" style="position: absolute; bottom: 100%; right: 0; background: var(--card-bg); color: var(--text-color); padding: 12px 16px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); white-space: nowrap; z-index: 1000; margin-bottom: 8px; border: 1px solid var(--border-color); display: none; font-size: 14px; font-weight: normal;">
                                            ุงุณุชุงุฐ ุดููู ุฌุงู ุงุฏุงุก ูุฑูู ุงูุนูู ุดูุฏ ุชููู ุงููุฑูู ูู1 ุงูู 5
                                        </span>
                                    </span>
                                </label>
                                <input type="number" id="team_rating_new_modal" min="1" max="5" maxlength="1" step="1" required style="width: 100px;" onkeydown="return false;">
                                <small style="color: var(--text-muted);">ุงุณุชุฎุฏู ุงูุฃุณูู ูุชุบููุฑ ุงูุชูููู (1-5)</small>
                                <div id="team_rating_penalty_display" style="margin-top: 8px; padding: 8px; background: rgba(239, 68, 68, 0.1); border-right: 3px solid var(--danger-color); border-radius: 4px; display: none;">
                                    <strong style="color: var(--danger-color);">ุงูุฎุตู: <span id="team_rating_penalty_value">0</span> ููุทุฉ</strong>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="subscription_amount_new_modal">ุงููุจูุบ ุงูููุจูุถ</label>
                                <input type="text" id="subscription_amount_new_modal" inputmode="numeric" pattern="[0-9]*" placeholder="ุฃุฏุฎู ุงููุจูุบ ุจุงูุฃูู (ูุซูุงู: 35)">
                                <small class="form-text" style="color: var(--text-muted); font-size: 0.85em; margin-top: 5px; display: block;">ุณูุชู ุถุฑุจ ุงููููุฉ ูู 1000 ุชููุงุฆูุงู (35 = 35000)</small>
                            </div>
                        </div>
                        
                        <!-- ููุงุท ุงูุจูุน (Upsell) Checklist -->
                        <div style="margin-top: 30px; padding: 20px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                            <h3 style="margin-bottom: 15px;">ููุงุท ุงูุจูุน (Upsell)</h3>
                            <div id="upsellContainer" class="checklist-horizontal">
                                <div class="checklist-item">
                                    <label class="checklist-label">
                                        <input type="checkbox" id="upsell_router_new_modal" class="check-item">
                                        ุจูุน ุฑุงูุชุฑ (+10)
                                    </label>
                                </div>
                                <div class="checklist-item">
                                    <label class="checklist-label">
                                        <input type="checkbox" id="upsell_onu_new_modal" class="check-item">
                                        ุจูุน ONU (+10)
                                    </label>
                                </div>
                                <div class="checklist-item">
                                    <label class="checklist-label">
                                        <input type="checkbox" id="upsell_ups_new_modal" class="check-item">
                                        ุจูุน UPS (+10)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ุงูุฎุฏูุงุช ุงููุดุฑูุญุฉ ูููุดุชุฑู (Checklist) -->
                        <div id="explainedServicesWrapper" style="display: none; margin-top: 30px; padding: 20px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                            <h3 style="margin-bottom: 15px;">ุงูุฎุฏูุงุช ุงููุดุฑูุญุฉ ูููุดุชุฑู</h3>
                            <div id="explainedServicesContainer" class="checklist-grid"></div>
                        </div>
                        
                        <!-- ูุฑุบุจ ุจุงูุงูุถูุงู ููุฑูุจ ุงููุงุชุณุงุจ -->
                        <div style="margin-top: 20px; padding: 20px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                            <div class="checklist-item" style="margin: 0;">
                                <label class="checklist-label">
                                    <input type="checkbox" id="whatsapp_group_interest_new_modal" class="check-item">
                                    ูุฑุบุจ ุจุงูุงูุถูุงู ููุฑูุจ ุงููุงุชุณุงุจ
                                </label>
                            </div>
                        </div>
                        
                        <!-- ูุญุชุงุฌ ูุชุงุจุนุฉ -->
                        <div style="margin-top: 20px; padding: 20px; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                            <div class="checklist-item" style="margin: 0;">
                                <label class="checklist-label">
                                    <input type="checkbox" id="needs_followup_new_modal" class="check-item">
                                    ูุญุชุงุฌ ูุชุงุจุนุฉ
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group" id="followupReasonGroupNewModal" style="display: none; margin-top: 20px;">
                            <label for="followup_reason_new_modal" style="margin-bottom: 10px; display: block; font-weight: 500;">ุณุจุจ ุงููุชุงุจุนุฉ</label>
                            <select id="followup_reason_new_modal" style="width: 100%; padding: 10px; border-radius: 8px; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
                                <option value="amount_mismatch">ูุจูุบ ุบูุฑ ูุชุทุงุจู</option>
                                <option value="technical_issue">ูุดููุฉ ูููุฉ</option>
                                <option value="violation">ุชุฌุงูุฒ</option>
                                <option value="complaint">ุดููู</option>
                                <option value="poor_service">ุฎุฏูุฉ ุฑุฏูุฆุฉ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="review_notes_new_modal">ููุงุญุธุงุช ุงูุฌูุฏุฉ</label>
                            <textarea id="review_notes_new_modal" rows="3"></textarea>
                        </div>
                        
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ุญูุธ ุงูุชูููู</button>
                            <button type="button" class="btn btn-success" onclick="generateMessageNewModal()">ุชูููุฏ ุฑุณุงูุฉ</button>
                        </div>
                    </form>
                </div>

                <!-- Generated Message -->
                <div id="messageSectionNewModal" style="display: none; margin-top: 20px;">
                    <h3>ุงูุฑุณุงูุฉ ุงูุฌุงูุฒุฉ</h3>
                    <div class="message-box">
                        <textarea id="generatedMessageNewModal" readonly></textarea>
                        <button class="btn btn-copy" onclick="copyMessageNewModal()">ูุณุฎ ุงูุฑุณุงูุฉ</button>
                    </div>
                </div>
                
                <!-- Action Buttons at the bottom -->
                <div style="border-top: 2px solid var(--border-color); margin-top: 30px; padding-top: 20px;">
                    <div class="btn-group" style="justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeNewTicketModal()">ุฅุบูุงู</button>
                        <button type="button" class="btn btn-secondary" onclick="resetFormModal()">ุฅุนุงุฏุฉ ุชุนููู</button>
                        <button type="submit" form="ticketFormModal" class="btn btn-primary">ุญูุธ ุงูุชุฐูุฑุฉ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Assign Ticket to Technician Modal -->
    <div id="assignTicketModal" class="modal-overlay" style="display: none;">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>ุฅุฑุณุงู ุชุฐูุฑุฉ ููููู</h2>
                <button class="modal-close-btn" onclick="closeAssignTicketModal()">ร</button>
            </div>
            <div class="modal-body">
                <form id="assignTicketForm">
                    <input type="hidden" id="assign_ticket_id">
                    <div class="form-group">
                        <label for="assign_technician_id">ุงุฎุชุฑ ุงูููู *</label>
                        <select id="assign_technician_id" required>
                            <option value="">ุงุฎุชุฑ ุงูููู</option>
                        </select>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">ุฅุฑุณุงู</button>
                        <button type="button" class="btn btn-secondary" onclick="closeAssignTicketModal()">ุฅูุบุงุก</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ticket Details Modal -->
    <!-- Error Modal for Date Validation -->
    <div id="date-error-modal" class="modal-overlay">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);">
                <h2 style="color: white; display: flex; align-items: center; gap: 10px;">
                    <span>โ๏ธ</span>
                    <span>ุฎุทุฃ ูู ุงูุชูุงุฑูุฎ</span>
                </h2>
                <button class="modal-close-btn" onclick="closeDateErrorModal()" style="color: white;">ร</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-right: 4px solid var(--danger-color); border-radius: 6px;">
                    <p style="margin: 0; color: var(--text-primary); font-weight: 500;">ูุฑุฌู ุชุตุญูุญ ุงูุฃุฎุทุงุก ุงูุชุงููุฉ:</p>
                </div>
                <ul id="date-error-list" style="list-style: none; padding: 0; margin: 0;">
                    <!-- Errors will be inserted here -->
                </ul>
                <div style="margin-top: 25px; display: flex; justify-content: flex-end;">
                    <button class="btn btn-primary" onclick="closeDateErrorModal()" style="min-width: 120px;">ููุงูู</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal for Ticket Creation -->
    <div id="ticket-success-modal" class="modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);">
                <h2 style="color: white; display: flex; align-items: center; gap: 10px;">
                    <span>โ</span>
                    <span>ุชู ุจูุฌุงุญ</span>
                </h2>
                <button class="modal-close-btn" onclick="closeTicketSuccessModal()" style="color: white;">ร</button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 40px 25px;">
                <div style="width: 80px; height: 80px; margin: 0 auto 25px; background: rgba(16, 185, 129, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px;">
                    โ
                </div>
                <h3 style="color: var(--text-primary); font-size: 24px; margin-bottom: 15px; font-weight: 600;">
                    ุชู ุฅุฏุฎุงู ุงูุชุฐูุฑุฉ ุจูุฌุงุญ!
                </h3>
                <p style="color: var(--text-secondary); font-size: 16px; line-height: 1.6; margin-bottom: 30px;">
                    ููููู ุงูุขู ุฅุถุงูุฉ ุงูุตูุฑ ูุชูููู ุงูุฌูุฏุฉ.
                </p>
                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-primary" onclick="closeTicketSuccessModal(true)" style="min-width: 150px; padding: 12px 24px; font-size: 16px;">
                        ูุชุงุจุนุฉ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="ticket-details-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>ุชูุงุตูู ุงูุชุฐูุฑุฉ #<span id="detail-ticket-number-modal"></span></h2>
                <button class="modal-close-btn" onclick="closeTicketDetailsModal()">ร</button>
            </div>
            <div class="modal-body">
                <!-- Ticket Basic Info (Read-only) -->
                <div id="ticketViewInfo" style="margin-bottom: 30px;">
                    <h3>ูุนูููุงุช ุงูุชุฐูุฑุฉ</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ุงุณู ุงููุดุชุฑู:</label>
                            <div class="read-only-field" id="view_subscriber_name">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุฑูู ุงููุดุชุฑู:</label>
                            <div class="read-only-field" id="view_subscriber_phone">-</div>
                        </div>
                        <div class="form-group">
                            <label>ููุน ุงูุชุฐูุฑุฉ:</label>
                            <div class="read-only-field" id="view_ticket_type">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุงููุฑูู:</label>
                            <div class="read-only-field" id="view_team_name">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุชุงุฑูุฎ ุงูุงุณุชูุงู (T0):</label>
                            <div class="read-only-field" id="view_time_received">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุชุงุฑูุฎ ุงูู ุฑุฏ (T1):</label>
                            <div class="read-only-field" id="view_time_first_contact">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุชุงุฑูุฎ ุงููุงู ุงูุชุฐูุฑุฉ (T2):</label>
                            <div class="read-only-field" id="view_time_completed">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุงูุญุงูุฉ:</label>
                            <div class="read-only-field" id="view_status">-</div>
                        </div>
                    </div>
                </div>

                <!-- Photos Display (Read-only) -->
                <div id="photosViewSection" style="margin-bottom: 30px;">
                    <h3>ุงูุตูุฑ</h3>
                    <div class="photo-grid" id="photoGridViewModal"></div>
                </div>

                <!-- Quality Review Display (Read-only) -->
                <div id="qualityReviewViewSection" style="margin-bottom: 30px;">
                    <h3>ุชูููู ุงูุฌูุฏุฉ</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ุญุงูุฉ ุงูุงุชุตุงู:</label>
                            <div class="read-only-field" id="view_contact_status">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุญุงูุฉ ุงูุฎุฏูุฉ:</label>
                            <div class="read-only-field" id="view_service_status">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุชูููู ุฃุฏุงุก ุงููุฑูู:</label>
                            <div class="read-only-field" id="view_team_rating">-</div>
                        </div>
                        <div class="form-group">
                            <label>ุชูููู ุงูุณููู:</label>
                            <div class="read-only-field" id="view_behavior_rating">-</div>
                        </div>
                        <div class="form-group">
                            <label>ูุจูุบ ุงูุงุดุชุฑุงู:</label>
                            <div class="read-only-field" id="view_subscription_amount">-</div>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>ููุงุท ุงูุจูุน (Upsell):</label>
                        <div class="read-only-field" id="view_upsell">-</div>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>ุงูุฎุฏูุงุช ุงููุดุฑูุญุฉ:</label>
                        <div class="read-only-field" id="view_explained_services">-</div>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>ููุงุญุธุงุช ุงูุฌูุฏุฉ:</label>
                        <div class="read-only-field" id="view_review_notes">-</div>
                    </div>
                </div>

                <!-- Scores Display -->
                <div id="scoresViewSection" style="margin-top: 30px;">
                    <h3>ุงูููุงุท</h3>
                    <div class="score-display" id="scoreDisplayViewModal"></div>
                </div>

                <!-- Edit Section (Only for Team Leader) -->
                <div id="editSectionForTeamLeader" style="display: none; margin-top: 30px; border-top: 2px solid var(--border-color); padding-top: 20px;">
                    <h3>ุชุนุฏูู ุงูุชุฐูุฑุฉ (Team Leader ููุท)</h3>
                    
                    <!-- Edit Ticket Form -->
                    <form id="editTicketFormModal">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="edit_subscriber_name">ุงุณู ุงููุดุชุฑู</label>
                                <input type="text" id="edit_subscriber_name">
                            </div>
                            <div class="form-group">
                                <label for="edit_subscriber_phone">ุฑูู ุงููุดุชุฑู</label>
                                <input type="text" id="edit_subscriber_phone">
                            </div>
                            <div class="form-group">
                                <label for="edit_ticket_type_id">ููุน ุงูุชุฐูุฑุฉ</label>
                                <select id="edit_ticket_type_id">
                                    <option value="">ุงุฎุชุฑ ุงูููุน</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit_team_id">ุงููุฑูู</label>
                                <select id="edit_team_id">
                                    <option value="">ุงุฎุชุฑ ุงููุฑูู</option>
                                </select>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ุญูุธ ุงูุชุนุฏููุงุช</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelEditTicket()">ุฅูุบุงุก</button>
                        </div>
                    </form>
                    
                    <!-- Edit Quality Review Form -->
                    <form id="editQualityReviewFormModal" style="margin-top: 30px;">
                        <h4>ุชุนุฏูู ุชูููู ุงูุฌูุฏุฉ</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="edit_contact_status">ุญุงูุฉ ุงูุงุชุตุงู *</label>
                                <select id="edit_contact_status" required>
                                    <option value="answered">ุชู ุงูุฑุฏ</option>
                                    <option value="no_answer">ูู ูุฑุฏ</option>
                                    <option value="closed">ูุบูู</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit_service_status">ุญุงูุฉ ุงูุฎุฏูุฉ *</label>
                                <select id="edit_service_status" required>
                                    <option value="excellent">ููุชุงุฒ</option>
                                    <option value="good">ุฌูุฏ</option>
                                    <option value="poor">ุฑุฏูุก</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit_team_rating">ุชูููู ุฃุฏุงุก ุงููุฑูู (1-5) *</label>
                                <input type="number" id="edit_team_rating" min="1" max="5" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_behavior_rating">ุชูููู ุงูุณููู *</label>
                                <select id="edit_behavior_rating" required>
                                    <option value="excellent">ููุชุงุฒ (+10)</option>
                                    <option value="good">ุฌูุฏ (+5)</option>
                                    <option value="normal">ุทุจูุนู (0)</option>
                                    <option value="bad">ุณูุก (-10)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit_subscription_amount">ูุจูุบ ุงูุงุดุชุฑุงู</label>
                                <input type="number" id="edit_subscription_amount" step="0.01">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ููุงุท ุงูุจูุน (Upsell):</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_upsell_router">
                                <label for="edit_upsell_router">ุจูุน ุฑุงูุชุฑ (+10)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_upsell_onu">
                                <label for="edit_upsell_onu">ุจูุน ONU (+10)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_upsell_ups">
                                <label for="edit_upsell_ups">ุจูุน UPS (+10)</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ุงูุฎุฏูุงุช ุงููุดุฑูุญุฉ ูููุดุชุฑู:</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_explained_sinmana">
                                <label for="edit_explained_sinmana">ุณูููุงูุง</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_explained_platform">
                                <label for="edit_explained_platform">ููุตุฉ</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_explained_mytv_plus">
                                <label for="edit_explained_mytv_plus">MyTV+</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_explained_shahid_plus">
                                <label for="edit_explained_shahid_plus">ุดุงูุฏ ุจูุณ</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_whatsapp_group_interest">
                                <label for="edit_whatsapp_group_interest">ูุฑุบุจ ุจุงูุงูุถูุงู ููุฑูุจ ุงููุงุชุณุงุจ</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="edit_needs_followup">
                                <label for="edit_needs_followup">ูุญุชุงุฌ ูุชุงุจุนุฉ</label>
                            </div>
                        </div>
                        <div class="form-group" id="editFollowupReasonGroup" style="display: none;">
                            <label for="edit_followup_reason">ุณุจุจ ุงููุชุงุจุนุฉ</label>
                            <select id="edit_followup_reason">
                                <option value="amount_mismatch">ูุจูุบ ุบูุฑ ูุชุทุงุจู</option>
                                <option value="technical_issue">ูุดููุฉ ูููุฉ</option>
                                <option value="violation">ุชุฌุงูุฒ</option>
                                <option value="complaint">ุดููู</option>
                                <option value="poor_service">ุฎุฏูุฉ ุฑุฏูุฆุฉ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit_review_notes">ููุงุญุธุงุช ุงูุฌูุฏุฉ</label>
                            <textarea id="edit_review_notes" rows="3"></textarea>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ุญูุธ ุงูุชุนุฏููุงุช</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelEditQualityReview()">ุฅูุบุงุก</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Review Section (for COMPLETED tickets) -->
            <div id="reviewSection" style="display: none; margin-top: 30px; padding-top: 30px; border-top: 2px solid var(--border-color);">
                <h3 style="margin-bottom: 20px; color: var(--primary-color);">ูุฑุงุฌุนุฉ ุงูุชุฐูุฑุฉ</h3>
                <form id="reviewForm">
                    <div class="form-group">
                        <label for="review_decision">ูุฑุงุฑ ุงููุฑุงุฌุนุฉ *</label>
                        <select id="review_decision" required>
                            <option value="">ุงุฎุชุฑ ุงููุฑุงุฑ</option>
                            <option value="approve">ููุงูู - ุฅุบูุงู ุงูุชุฐูุฑุฉ</option>
                            <option value="followup">ูุญุชุงุฌ ูุชุงุจุนุฉ</option>
                        </select>
                    </div>
                    <div class="form-group" id="followupReasonGroupReview" style="display: none;">
                        <label for="followup_reason_review">ุณุจุจ ุงููุชุงุจุนุฉ</label>
                        <select id="followup_reason_review">
                            <option value="photos_missing">ุตูุฑ ูุงูุตุฉ</option>
                            <option value="quality_issue">ูุดููุฉ ูู ุงูุฌูุฏุฉ</option>
                            <option value="incorrect_info">ูุนูููุงุช ุบูุฑ ุตุญูุญุฉ</option>
                            <option value="other">ุฃุฎุฑู</option>
                        </select>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-success">ุญูุธ ุงููุฑุงุฌุนุฉ</button>
                        <button type="button" class="btn btn-secondary" onclick="closeReviewSection()">ุฅูุบุงุก</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page-content" style="display: none;">
                <!-- Notifications Settings (shared UI injected by /js/settings-notifications.js) -->
            </div>
        </main>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/menu-config.js"></script>
    <script src="/js/settings-notifications.js"></script>
    <script src="/js/dashboard-nav.js"></script>
    <script src="/js/datetime-picker.js"></script>
    <script src="/js/time-picker.js"></script>
    <script src="/js/quality-staff.js"></script>
    <script>
        // Ensure openNewTicketModal is available immediately
        (function() {
            // Wait for quality-staff.js to load
            function ensureFunctionAvailable() {
                if (typeof window.openNewTicketModal === 'function') {
                    // Function is already available
                    return;
                }
                
                // Try to get it from the global scope
                if (typeof openNewTicketModal === 'function') {
                    window.openNewTicketModal = openNewTicketModal;
                    return;
                }
                
                // If still not available, wait a bit and try again
                setTimeout(ensureFunctionAvailable, 100);
            }
            
            // Start checking after DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', ensureFunctionAvailable);
            } else {
                ensureFunctionAvailable();
            }
        })();
        
        // Fallback: Define a temporary function that will be replaced
        if (typeof window.openNewTicketModal === 'undefined') {
            window.openNewTicketModal = function() {
                console.warn('openNewTicketModal is being called but not yet loaded. Retrying...');
                setTimeout(function() {
                    if (typeof window.openNewTicketModal === 'function' && window.openNewTicketModal.toString().indexOf('console.warn') === -1) {
                        window.openNewTicketModal();
                    }
                }, 100);
            };
        }
        
        // Force ticket number validation - ensure it runs after page load
        (function() {
            function initTicketNumberValidation() {
                const ticketNumberInput = document.getElementById('ticket_number');
                if (!ticketNumberInput) {
                    setTimeout(initTicketNumberValidation, 100);
                    return;
                }
                
                // Function to show error message
                function showError(message) {
                    let errorDiv = document.getElementById('ticket_number_error');
                    if (!errorDiv) {
                        errorDiv = document.createElement('div');
                        errorDiv.id = 'ticket_number_error';
                        errorDiv.className = 'error-message';
                        errorDiv.style.cssText = 'display: none; color: #dc3545; font-size: 0.875em; margin-top: 5px; padding: 8px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px;';
                        ticketNumberInput.parentNode.appendChild(errorDiv);
                    }
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                    ticketNumberInput.style.borderColor = '#dc3545';
                    ticketNumberInput.style.backgroundColor = '#fff5f5';
                }
                
                function hideError() {
                    const errorDiv = document.getElementById('ticket_number_error');
                    if (errorDiv) {
                        errorDiv.style.display = 'none';
                        ticketNumberInput.style.borderColor = '';
                        ticketNumberInput.style.backgroundColor = '';
                    }
                }
                
                // STRICT: Block ALL non-numeric input at keydown level
                ticketNumberInput.addEventListener('keydown', function(e) {
                    const allowedKeys = ['Backspace', 'Delete', 'Tab', 'Escape', 'Enter', 
                                        'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
                                        'Home', 'End', 'PageUp', 'PageDown'];
                    
                    if (e.ctrlKey || e.metaKey) {
                        if (['a', 'c', 'x', 'z'].includes(e.key.toLowerCase())) {
                            return;
                        }
                        if (e.key.toLowerCase() === 'v') {
                            e.preventDefault();
                            return;
                        }
                    }
                    
                    if (allowedKeys.includes(e.key)) {
                        return;
                    }
                    
                    const charCode = e.key.charCodeAt ? e.key.charCodeAt(0) : e.keyCode;
                    const isDigit = (charCode >= 48 && charCode <= 57);
                    
                    if (!isDigit) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        showError('โ ุชู ุฑูุถ ุงูุญุฑู/ุงูุฑูุฒ: "' + e.key + '" - ุฑูู ุงูุชุฐูุฑุฉ ููุจู ุฃุฑูุงู ุฅูุฌููุฒูุฉ ููุท (0-9)');
                        setTimeout(hideError, 3000);
                        return false;
                    } else {
                        hideError();
                    }
                }, true);
                
                // STRICT: Clean input on every input event
                ticketNumberInput.addEventListener('input', function(e) {
                    const value = e.target.value;
                    const cleaned = value.replace(/[^0-9]/g, '');
                    if (value !== cleaned) {
                        e.target.value = cleaned;
                        const invalidChars = value.replace(/[0-9]/g, '');
                        showError('โ ุชู ุฑูุถ ุงูููู ุงูุชุงููุฉ: "' + invalidChars + '" - ุฑูู ุงูุชุฐูุฑุฉ ููุจู ุฃุฑูุงู ุฅูุฌููุฒูุฉ ููุท (0-9)');
                        setTimeout(hideError, 5000);
                    } else {
                        hideError();
                    }
                }, true);
                
                // STRICT: Handle paste
                ticketNumberInput.addEventListener('paste', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                    const numbersOnly = pastedText.replace(/[^0-9]/g, '');
                    const invalidChars = pastedText.replace(/[0-9]/g, '');
                    
                    if (invalidChars.length > 0) {
                        showError('โ ุชู ุฑูุถ ุงูููู ุงูููุณูุฎุฉ: "' + invalidChars + '" - ุฑูู ุงูุชุฐูุฑุฉ ููุจู ุฃุฑูุงู ุฅูุฌููุฒูุฉ ููุท (0-9)');
                        setTimeout(hideError, 5000);
                    }
                    
                    const start = e.target.selectionStart || 0;
                    const end = e.target.selectionEnd || 0;
                    const currentValue = e.target.value || '';
                    e.target.value = currentValue.substring(0, start) + numbersOnly + currentValue.substring(end);
                    e.target.setSelectionRange(start + numbersOnly.length, start + numbersOnly.length);
                    e.target.dispatchEvent(new Event('input', { bubbles: true }));
                }, true);
                
                // STRICT: Clean on blur
                ticketNumberInput.addEventListener('blur', function(e) {
                    const value = e.target.value;
                    const cleaned = value.replace(/[^0-9]/g, '');
                    if (value !== cleaned) {
                        e.target.value = cleaned;
                        const invalidChars = value.replace(/[0-9]/g, '');
                        showError('โ ุชู ุฑูุถ ุงูููู: "' + invalidChars + '" - ุฑูู ุงูุชุฐูุฑุฉ ููุจู ุฃุฑูุงู ุฅูุฌููุฒูุฉ ููุท (0-9)');
                    } else {
                        hideError();
                    }
                }, true);
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initTicketNumberValidation);
            } else {
                initTicketNumberValidation();
            }
        })();
    </script>

    <!-- Create Ticket Modal (Simplified for Support/Call Center) -->
    <div id="create-ticket-modal" class="modal-overlay">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2>ุฅูุดุงุก ุชุฐูุฑุฉ ุฌุฏูุฏ</h2>
                <button class="modal-close-btn" onclick="closeCreateTicketModal()">ร</button>
            </div>
            <div class="modal-body">
                <form id="createTicketForm">
                    <div class="form-grid">
                        <!-- ุฑูู ุงูุชุฐูุฑุฉ - ุชูููุฏ ุชููุงุฆู (ููุนุฑุถ ููุท) -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="create_ticket_number">ุฑูู ุงูุชุฐูุฑุฉ</label>
                            <input type="text" id="create_ticket_number" readonly style="background-color: var(--bg-tertiary); color: var(--text-secondary); cursor: not-allowed;">
                            <small class="form-text" style="color: var(--text-muted); font-size: 0.85em;">ุณูุชู ุชูููุฏู ุชููุงุฆูุงู ูู ุงููุธุงู</small>
                        </div>
                        
                        <!-- ุงุณู ุงููุดุชุฑู -->
                        <div class="form-group">
                            <label for="create_subscriber_name">ุงุณู ุงููุดุชุฑู *</label>
                            <input type="text" id="create_subscriber_name" required placeholder="ุฃุฏุฎู ุงุณู ุงููุดุชุฑู">
                        </div>
                        
                        <!-- ุฑูู ุงููุงุชู -->
                        <div class="form-group">
                            <label for="create_subscriber_phone">ุฑูู ุงููุงุชู *</label>
                            <input type="text" id="create_subscriber_phone" pattern="[0-9]{11}" inputmode="numeric" maxlength="11" autocomplete="off" required placeholder="11 ุฑูู">
                            <small class="form-text" style="color: var(--text-muted); font-size: 0.85em;">ูุฌุจ ุฃู ูุญุชูู ุนูู 11 ุฑูู ุฅูุฌููุฒู ููุท (0-9)</small>
                            <div id="create_subscriber_phone_error" class="error-message" style="display: none;"></div>
                        </div>
                        
                        <!-- ููุน ุงูุชุฐูุฑุฉ -->
                        <div class="form-group">
                            <label for="create_ticket_type_id">ููุน ุงูุชุฐูุฑุฉ *</label>
                            <select id="create_ticket_type_id" required onchange="handleTicketTypeChange()">
                                <option value="">ุงุฎุชุฑ ุงูููุน</option>
                            </select>
                        </div>
                        
                        <!-- ููุน ุงูุชุฐูุฑุฉ ุงููุฎุตุต (ูุธูุฑ ููุท ุนูุฏ ุงุฎุชูุงุฑ "ูุฎุตุต") -->
                        <div class="form-group" id="create_custom_ticket_type_group" style="display: none;">
                            <label for="create_custom_ticket_type">ุงูุชุจ ููุน ุงูุชุฐูุฑุฉ ุงููุฎุตุต *</label>
                            <input type="text" id="create_custom_ticket_type" placeholder="ุฃุฏุฎู ููุน ุงูุชุฐูุฑุฉ ุงููุทููุจ">
                        </div>
                        
                        <!-- ุงูููุทูุฉ -->
                        <div class="form-group">
                            <label for="create_region">ุงูููุทูุฉ</label>
                            <input type="text" id="create_region" placeholder="ุฃุฏุฎู ุงูููุทูุฉ">
                        </div>
                        
                        <!-- ุงูููุงุญุธุงุช -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="create_notes">ููุงุญุธุงุช</label>
                            <textarea id="create_notes" rows="4" placeholder="ุฃุฏุฎู ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-family: inherit; resize: vertical;"></textarea>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateTicketModal()">ุฅูุบุงุก</button>
                        <button type="button" class="btn btn-primary" onclick="saveTicketOnlyQuality()">๐พ ุญูุธ ููุท</button>
                        <button type="button" class="btn btn-success" onclick="saveTicketAndNotifyQuality()">๐พ ุญูุธ ูุฅุฑุณุงู ุชูุจูู ููููู</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="modal-overlay" style="display: none;">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="alert-title">ุชูุจูู</h2>
                <button class="modal-close-btn" onclick="closeAlertModal()">ร</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <div id="alert-icon" style="font-size: 48px; line-height: 1;">โ๏ธ</div>
                    <p id="alert-message" style="flex: 1; margin: 0; font-size: 16px; line-height: 1.6;"></p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-primary" onclick="closeAlertModal()" id="alert-ok-btn">ููุงูู</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

